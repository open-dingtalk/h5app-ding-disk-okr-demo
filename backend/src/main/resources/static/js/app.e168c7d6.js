(function(e){function n(n){for(var r,o,c=n[0],s=n[1],u=n[2],p=0,g=[];p<c.length;p++)o=c[p],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&g.push(i[o][0]),i[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);d&&d(n);while(g.length)g.shift()();return a.push.apply(a,u||[]),t()}function t(){for(var e,n=0;n<a.length;n++){for(var t=a[n],r=!0,c=1;c<t.length;c++){var s=t[c];0!==i[s]&&(r=!1)}r&&(a.splice(n--,1),e=o(o.s=t[0]))}return e}var r={},i={app:0},a=[];function o(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=r,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=n,c=c.slice();for(var u=0;u<c.length;u++)n(c[u]);var d=s;a.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),i=t("5c96"),a=t.n(i),o=(t("0fae"),function(){var e=this,n=e.$createElement,r=e._self._c||n;return r("div",{attrs:{id:"app"}},[r("div",{staticClass:"header"},[r("img",{staticClass:"logo",attrs:{src:t("cf05")}}),r("b",[e._v("北极星OKR模版")])]),r("div",{staticClass:"container"},[r("div",{staticClass:"main"},[r("el-form",{ref:"form"},[r("el-form-item",{attrs:{label:"上传附件: "}},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.upload}},[e._v("上传")])],1),r("el-form-item",{attrs:{label:"附件列表: "}},e._l(e.files,(function(n){return r("div",{key:n.url,staticClass:"file-item"},[r("div",{staticClass:"icon el-icon-notebook-2"}),r("div",[e._v(e._s(n.name))]),r("el-button",{staticClass:"preview-btn",attrs:{type:"text"},on:{click:function(t){return e.preview(n)}}},[e._v("预览")])],1)})),0)],1)],1)])])}),c=[],s=t("b85c"),u=t("1da1"),d=(t("e9c4"),t("b0c0"),t("ac1f"),t("1276"),t("96cf"),t("caad"),t("2532"),t("bc3a")),p=t.n(d),g=t("b383"),l=t.n(g),f="";window.isDemo1=f.includes("demo1.topscrm.cn")||location.href.includes("demo1.topscrm.cn");var m={getAppConfig:"/dingding/demo/getDingConfig",getDingInfo:"/dingding/demo/getSign",getDingSpaceId:"/dingding/demo/cusSpace/getCusSpace",grantDingCusSpace:"/dingding/demo/cusSpace/getGrantCusSpace"},v=p.a.create({baseURL:f+(window.isDemo1?"/v3":""),timeout:0,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"}});function I(e,n,t){return v.get(m[e],{params:n},t)}function w(e,n,t){return t&&t.json&&(t.headers={"Content-Type":"application/json;charset=UTF-8"}),n&&window.token&&(n.token=window.token),v.post(m[e],t&&t.json?n:l.a.stringify(n),t)}v.interceptors.request.use((function(e){return window.token&&(e.headers.token=window.token),e})),v.interceptors.response.use((function(e){return e.data}));var h={getAppConfig:function(e){return I("getAppConfig",e)},getDingInfo:function(e){return w("getDingInfo",e,{json:!0})},getDingSpaceId:function(e){return w("getDingSpaceId",e,{json:!0})},grantDingCusSpace:function(e){return w("grantDingCusSpace",e,{json:!0})}},b=h,y={data:function(){return{dingCorpId:"",dingAgentId:"",dingUserId:"",files:[]}},methods:{upload:function(e){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:setTimeout((function(){n.uploadFile({})}),30);case 1:case"end":return e.stop()}}),e)})))()},getDingSpaceId:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,b.getDingSpaceId({dingAgentId:e.dingAgentId,dingCorpId:e.dingCorpId,dingDomain:"aaa"});case 2:if(t=n.sent,!t.success){n.next=7;break}return n.abrupt("return",t.data);case 7:return n.abrupt("return","");case 8:case"end":return n.stop()}}),n)})))()},grantDingCusSpace:function(e){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.type,i=e.fileIds,t.next=3,b.grantDingCusSpace({dingUserId:n.dingUserId,dingAgentId:n.dingAgentId,dingCorpId:n.dingCorpId,fileIds:i||null,grantType:r,dingDomain:"aaa"});case 3:return a=t.sent,t.abrupt("return",!!a.success);case 5:case"end":return t.stop()}}),t)})))()},uploadFile:function(e){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.getDingSpaceId();case 2:return r=t.sent,t.next=5,n.grantDingCusSpace({type:"add"});case 5:i=t.sent,r&&i&&dd.biz.util.uploadAttachment({multiple:!!e.multiple,image:{multiple:!!e.multiple,compress:!1!==e.compress,max:e.max||1,spaceId:r},space:{corpId:n.dingCorpId,spaceId:r,max:e.max||1},file:{spaceId:r,max:e.max||1},types:e.types||["file","space"],onSuccess:function(e){if(e&&e.data&&e.data.length){var t,r=Object(s["a"])(e.data);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.files.push({url:i.fileId,name:i.fileName,size:i.fileSize,fileType:i.fileType})}}catch(a){r.e(a)}finally{r.f()}}},onFail:function(e){alert(JSON.stringify(e||{msg:"未知错误"}))}});case 7:case"end":return t.stop()}}),t)})))()},preview:function(e){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.getDingSpaceId();case 2:return r=t.sent,i=e.url,t.next=6,n.grantDingCusSpace({type:"download",fileIds:i});case 6:a=t.sent,r&&a&&dd.biz.cspace.preview({corpId:n.dingCorpId,fileId:i,fileName:e.name,fileSize:e.size,fileType:e.fileType,spaceId:r,onSuccess:function(e){},onFail:function(e){alert(JSON.stringify(e||{msg:"未知错误"}))}});case 8:case"end":return t.stop()}}),t)})))()},config:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var t,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,b.getDingInfo({authCode:e.code,url:location.href.split("#")[0]});case 2:t=n.sent,t.success?(r={agentId:t.data.agentId||t.data.dingAgentId||e.dingAgentId,corpId:t.data.corpId||t.data.dingCorpId||e.dingCorpId,timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,signature:t.data.signature,type:0,jsApiList:["biz.util.uploadAttachment","biz.cspace.chooseSpaceDir","biz.cspace.saveFile","biz.cspace.preview"]},r.corpId&&(e.dingCorpId=r.corpId),r.agentId&&(e.dingAgentId=r.agentId),t.data.dingUserId&&(e.dingUserId=t.data.dingUserId),t.data.token&&(window.token=t.data.token),dd.config(r)):alert(t.message||"err getDingInfo");case 4:case"end":return n.stop()}}),n)})))()}},mounted:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,b.getAppConfig();case 2:t=n.sent,t.success?(dd.ready((function(){e.dingCorpId=t.data.dingCorpId,e.dingAgentId=t.data.dingAgentId,dd.runtime.permission.requestAuthCode({corpId:e.dingCorpId,onSuccess:function(n){e.code=n.code,e.config()},onFail:function(e){alert(JSON.stringify(e||{msg:"dd.runtime.permission.requestAuthCode"}))}})})),dd.error((function(e){alert(JSON.stringify(e||{msg:"dd.error"}))}))):alert(t.message||"err getAppConfig");case 4:case"end":return n.stop()}}),n)})))()}},C=y,S=(t("5c0b"),t("2877")),x=Object(S["a"])(C,o,c,!1,null,null,null),j=x.exports,D=t("2c18");window.dd=D,r["default"].config.productionTip=!1,r["default"].use(a.a),new r["default"]({render:function(e){return e(j)}}).$mount("#app")},"5c0b":function(e,n,t){"use strict";t("9c0c")},"9c0c":function(e,n,t){},cf05:function(e,n,t){e.exports=t.p+"img/logo.a7fd4060.png"}});