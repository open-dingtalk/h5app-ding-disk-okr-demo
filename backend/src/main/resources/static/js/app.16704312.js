(function(e){function n(n){for(var r,o,c=n[0],u=n[1],s=n[2],p=0,g=[];p<c.length;p++)o=c[p],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&g.push(i[o][0]),i[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);d&&d(n);while(g.length)g.shift()();return a.push.apply(a,s||[]),t()}function t(){for(var e,n=0;n<a.length;n++){for(var t=a[n],r=!0,c=1;c<t.length;c++){var u=t[c];0!==i[u]&&(r=!1)}r&&(a.splice(n--,1),e=o(o.s=t[0]))}return e}var r={},i={app:0},a=[];function o(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=r,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=n,c=c.slice();for(var s=0;s<c.length;s++)n(c[s]);var d=u;a.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),i=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("div",[e._v(" 请输入登录用户的token，用于请求接口： "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.token,expression:"token"}],attrs:{type:"text"},domProps:{value:e.token},on:{input:function(n){n.target.composing||(e.token=n.target.value)}}})]),t("div",[e._v(" 请输入dingCorpId： "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.dingCorpId,expression:"dingCorpId"}],attrs:{type:"text"},domProps:{value:e.dingCorpId},on:{input:function(n){n.target.composing||(e.dingCorpId=n.target.value)}}})]),t("div",[e._v(" 请输入dingAgentId： "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.dingAgentId,expression:"dingAgentId"}],attrs:{type:"text"},domProps:{value:e.dingAgentId},on:{input:function(n){n.target.composing||(e.dingAgentId=n.target.value)}}})]),t("div",[e._v(" 请输入dingUserId： "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.dingUserId,expression:"dingUserId"}],attrs:{type:"text"},domProps:{value:e.dingUserId},on:{input:function(n){n.target.composing||(e.dingUserId=n.target.value)}}})]),t("div",[t("button",{on:{click:e.upload}},[e._v("上传附件")])]),t("div",e._l(e.files,(function(n){return t("div",{key:n.url,staticClass:"file-item"},[e._v(" "+e._s(n.name)+" "),t("button",{on:{click:function(t){return e.preview(n)}}},[e._v("预览附件")])])})),0)])},a=[],o=t("b85c"),c=t("1da1"),u=(t("e9c4"),t("b0c0"),t("ac1f"),t("1276"),t("96cf"),t("caad"),t("2532"),t("bc3a")),s=t.n(u),d=t("b383"),p=t.n(d),g={getDingInfo:"/dingding/getSign",getDingSpaceId:"/dingding/cusSpace/getCusSpace",grantDingCusSpace:"/dingding/cusSpace/getGrantCusSpace"},l=s.a.create({baseURL:(location.href.includes("demo1.topscrm.cn"),""),timeout:0,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"}});function f(e,n,t){return t&&t.json&&(t.headers={"Content-Type":"application/json;charset=UTF-8"}),l.post(g[e],t&&t.json?n:p.a.stringify(n),t)}l.interceptors.request.use((function(e){return e.headers.token=window.token,e})),l.interceptors.response.use((function(e){return e.data}));var m={getDingInfo:function(e){return f("getDingInfo",e,{json:!0})},getDingSpaceId:function(e){return f("getDingSpaceId",e,{json:!0})},grantDingCusSpace:function(e){return f("grantDingCusSpace",e,{json:!0})}},v=m,I={data:function(){return{token:"",dingCorpId:"",dingAgentId:"806630498",dingUserId:"2227162436785834",files:[]}},methods:{upload:function(e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.config();case 2:setTimeout((function(){n.uploadFile({})}),30);case 3:case"end":return e.stop()}}),e)})))()},getDingSpaceId:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,v.getDingSpaceId({dingAgentId:e.dingAgentId,dingCorpId:e.dingCorpId});case 2:if(t=n.sent,!t.success){n.next=7;break}return n.abrupt("return",t.data);case 7:return n.abrupt("return","");case 8:case"end":return n.stop()}}),n)})))()},grantDingCusSpace:function(e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.type,i=e.fileIds,t.next=3,v.grantDingCusSpace({dingUserId:n.dingUserId,dingAgentId:n.dingAgentId,dingCorpId:n.dingCorpId,fileIds:i||null,grantType:r});case 3:return a=t.sent,t.abrupt("return",!!a.success);case 5:case"end":return t.stop()}}),t)})))()},uploadFile:function(e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.getDingSpaceId();case 2:return r=t.sent,t.next=5,n.grantDingCusSpace({type:"add"});case 5:i=t.sent,r&&i&&dd.biz.util.uploadAttachment({multiple:!!e.multiple,image:{multiple:!!e.multiple,compress:!1!==e.compress,max:e.max||1,spaceId:r},space:{corpId:n.dingCorpId,spaceId:r,max:e.max||1},file:{spaceId:r,max:e.max||1},types:e.types||["file","space"],onSuccess:function(e){if(e&&e.data&&e.data.length){var n,t=[],r=Object(o["a"])(e.data);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.push({url:i.fileId,name:i.fileName,size:i.fileSize,fileType:i.fileType}),this.files=t}}catch(a){r.e(a)}finally{r.f()}}},onFail:function(e){alert(JSON.stringify(e||{msg:"未知错误"}))}});case 7:case"end":return t.stop()}}),t)})))()},preview:function(e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.getDingSpaceId();case 2:return r=t.sent,i=e.url,t.next=6,n.grantDingCusSpace({type:"download",fileIds:i});case 6:a=t.sent,r&&a&&dd.biz.cspace.preview({corpId:n.dingCorpId,fileId:i,fileName:e.name,fileSize:e.size,fileType:e.fileType,spaceId:r,onSuccess:function(e){},onFail:function(e){alert(JSON.stringify(e||{msg:"未知错误"}))}});case 8:case"end":return t.stop()}}),t)})))()},config:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var t,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.token&&(window.token=e.token),n.next=3,v.getDingInfo({url:window.encodeURIComponent(location.href.split("#")[0])});case 3:t=n.sent,t.success?(r={agentId:t.data.agentId,corpId:t.data.corpId,timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,signature:t.data.signature,type:0,jsApiList:["biz.util.uploadAttachment","biz.cspace.chooseSpaceDir","biz.cspace.saveFile","biz.cspace.preview"]},e.dingCorpId||(e.dingCorpId=r.corpId),e.dingAgentId||(e.dingAgentId=r.agentId),dd.config(r),dd.ready((function(){})),dd.error((function(e){alert(JSON.stringify(e||{msg:"未知错误"}))}))):alert(t.message||"获取授权信息失败");case 5:case"end":return n.stop()}}),n)})))()}},mounted:function(){this.config()}},h=I,w=t("2877"),b=Object(w["a"])(h,i,a,!1,null,null,null),y=b.exports,x=t("2c18");window.dd=x,r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(y)}}).$mount("#app")}});